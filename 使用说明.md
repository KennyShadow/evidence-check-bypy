# 收入证据管理程序 - 使用说明

## 程序简介

收入证据管理程序是一个专业的收入数据管理工具，主要用于管理和分析企业收入确认数据，支持Excel数据导入、数据筛选、统计分析等功能。

## 主要功能

### 1. Excel数据导入
- **多工作表支持**: 自动检测Excel文件中的所有工作表，可选择需要导入的工作表
- **智能列名映射**: 自动识别和映射常见的列名格式
- **数据预览**: 导入前可预览工作表内容，确认数据格式
- **错误处理**: 详细的错误报告和数据验证

### 2. 数据管理
- **记录编辑**: 支持编辑现有收入记录的详细信息
- **新增记录**: 手动添加新的收入记录
- **记录删除**: 删除不需要的记录（支持确认对话框）
- **批量操作**: 支持批量导入和处理

### 3. 数据筛选和搜索
- **多维度筛选**: 按差异状态、附件状态、合同状态进行筛选
- **实时搜索**: 支持关键词搜索，实时显示结果
- **组合筛选**: 可同时应用多个筛选条件

### 4. 统计分析
- **实时统计**: 左侧面板显示当前筛选结果的统计信息
- **详细报告**: 提供完整的统计分析报告
- **差异分析**: 自动计算和显示收入差异情况

### 5. 数据导出
- **Excel导出**: 将筛选后的数据导出为Excel文件
- **格式保持**: 保持原有的数据格式和结构

## 使用方法

### 首次启动

1. 运行 `python main.py` 启动程序
2. 程序会自动创建必要的数据目录和配置文件
3. 主界面分为四个主要区域：
   - 顶部工具栏：文件操作和数据操作按钮
   - 左侧筛选面板：数据筛选选项和统计信息
   - 中央数据表格：显示收入记录
   - 底部状态栏：显示程序状态和版本信息

### Excel数据导入

#### 支持的Excel格式
- Excel 2007及以上版本 (.xlsx)
- Excel 97-2003 (.xls)

#### 导入步骤
1. 点击工具栏的 **"导入Excel"** 按钮
2. 选择要导入的Excel文件
3. 在工作表选择对话框中：
   - 查看所有可用的工作表
   - 选择要导入的工作表
   - 预览数据确认格式正确
   - 点击 **"导入此工作表"**
4. 程序会自动处理数据并显示导入结果

#### 列名映射规则
程序会自动识别以下列名：

**合同号列** (必需):
- 合同号、合同编号、契约号
- 包含 "contract" 的英文列名

**客户名列** (必需):
- 客户名、客户名称、公司名称、企业名称
- 包含 "client"、"company" 的英文列名

**收入列** (必需):
- 本年确认的收入、确认收入、收入金额、年度收入
- 包含 "income"、"revenue" 的英文列名

**附件收入列** (可选):
- 附件确认的收入、附件收入、证明收入

### 数据记录管理

#### 新增记录
1. 点击 **"新增记录"** 按钮
2. 填写记录信息：
   - 合同号（必填）
   - 客户名（必填）
   - 本年确认的收入（必填，必须大于0）
   - 附件确认的收入（可选）
   - 差异备注（可选）
   - 是否新增合同（可选）
3. 点击 **"保存"** 完成添加

#### 编辑记录
1. 在数据表格中找到要编辑的记录
2. 点击该记录行的 **"编辑"** 按钮
3. 修改需要更改的信息
4. 点击 **"保存"** 完成修改

#### 删除记录
1. 在数据表格中找到要删除的记录
2. 点击该记录行的 **"删除"** 按钮
3. 在确认对话框中点击 **"是"** 确认删除

### 数据筛选和搜索

#### 使用筛选器
左侧筛选面板提供三种筛选选项：

**差异状态筛选**:
- 全部：显示所有记录
- 有差异：只显示本年确认收入与附件确认收入不一致的记录
- 无差异：只显示本年确认收入与附件确认收入一致的记录
- 未确认：只显示未设置附件确认收入的记录

**附件状态筛选**:
- 全部：显示所有记录
- 已关联附件：只显示有附件文件的记录
- 未关联附件：只显示无附件文件的记录

**合同状态筛选**:
- 全部：显示所有记录
- 新增合同：只显示标记为新增的合同
- 现有合同：只显示现有的合同

#### 使用搜索功能
1. 在右上角的搜索框中输入关键词
2. 程序会实时搜索以下字段：
   - 合同号
   - 客户名
   - 差异备注
   - 收入金额
3. 点击 **"清除"** 按钮可清空搜索条件

#### 组合使用
- 可以同时使用筛选器和搜索功能
- 筛选条件会叠加应用
- 使用 **"清除筛选"** 按钮可一次性清除所有筛选条件

### 统计分析

#### 实时统计
左侧面板下方显示当前数据的统计信息：
- 总记录数
- 总收入金额
- 平均收入
- 有差异记录数
- 有附件记录数
- 新增合同数

#### 详细统计
1. 点击 **"统计分析"** 按钮
2. 查看完整的统计报告，包括：
   - 数据概览
   - 差异分析
   - 附件状态
   - 合同状态
   - 数据库信息

### 数据导出

1. 使用筛选器选择要导出的数据
2. 点击 **"导出数据"** 按钮
3. 选择保存位置和文件名
4. 程序会将当前筛选结果导出为Excel文件

## 数据格式说明

### 收入记录字段

| 字段名 | 类型 | 必需 | 说明 |
|--------|------|------|------|
| 合同号 | 文本 | 是 | 唯一标识符，不能为空 |
| 客户名 | 文本 | 是 | 客户名称，不能为空 |
| 本年确认的收入 | 数值 | 是 | 必须大于0的数值 |
| 附件确认的收入 | 数值 | 否 | 可选，不能为负数 |
| 差异 | 数值 | 否 | 自动计算：本年确认收入 - 附件确认收入 |
| 差异备注 | 文本 | 否 | 对差异的说明 |
| 附件数量 | 数值 | 否 | 自动统计关联的附件文件数量 |
| 导入时间 | 日期时间 | 否 | 自动记录 |
| 变化标识 | 文本 | 否 | 显示相对于上次导入的变化 |

## 文件结构

```
收入证据管理程序/
├── main.py                 # 主程序入口
├── requirements.txt        # 依赖包列表
├── README.md              # 项目说明
├── 使用说明.md            # 本文档
├── src/                   # 源代码目录
│   ├── __init__.py
│   ├── config.py          # 配置文件
│   ├── models/            # 数据模型
│   ├── data/              # 数据处理
│   └── gui/               # 图形界面
└── data/                  # 数据目录（自动创建）
    ├── database.pkl       # 数据库文件
    ├── app.log           # 日志文件
    └── backups/          # 备份目录
```

## 故障排除

### 常见问题

**1. 导入Excel时提示"合同号为空"**
- 检查Excel文件的列名是否正确
- 确认选择了正确的工作表
- 查看数据预览确认数据格式

**2. 程序无法启动**
- 确认已安装所有依赖包：`pip install -r requirements.txt`
- 检查Python版本（建议3.8及以上）

**3. 数据显示不正确**
- 使用"清除筛选"按钮重置所有筛选条件
- 重新启动程序重新加载数据

**4. 统计信息错误**
- 检查是否有空白或异常数据
- 重新导入数据

### 日志文件

程序运行日志保存在 `data/app.log` 文件中，包含：
- 程序启动和关闭记录
- 数据导入导出记录
- 错误和警告信息
- 操作历史记录

### 数据备份

- 数据库文件：`data/database.pkl`
- 自动备份：程序会定期创建数据备份
- 手动备份：复制整个 `data` 目录

## 联系支持

如果在使用过程中遇到问题，请：
1. 查看日志文件 `data/app.log` 了解详细错误信息
2. 检查本使用说明的故障排除部分
3. 准备问题复现步骤和相关文件信息

## 版本信息

- 当前版本：v1.0.0
- 更新日期：2025年6月
- 支持平台：Windows、macOS、Linux 