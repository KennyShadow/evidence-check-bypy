------

## 收入证据管理程序需求文档 - 终版

### 1. 引言

#### 1.1 项目背景

本项目旨在开发一款个人收入证据管理程序，旨在帮助用户高效地管理各类收入证据，实现收入数据与附件的关联、差异核算、版本对比及数据统计分析，从而提高个人财务管理的准确性和便捷性。

#### 1.2 项目目标

- 提供一个集中化的平台，方便用户管理个人收入数据和相关证据。
- 实现收入数据与附件的智能关联，简化证据归档过程。
- 自动化核算收入差异，并支持差异原因备注。
- 提供收入数据版本对比功能，追踪收入变化。
- 提供基础统计分析功能，帮助用户了解收入状况。
- 提供整洁美观的用户界面，提升用户体验。

#### 1.3 术语定义

- **收入大表**：用户导入的包含详细收入信息的表格数据，通常为Excel文件。
- **合同号**：收入大表中唯一标识每一笔收入或合同的编码。
- **客户名**：收入大表中与合同相关的客户名称。
- **本年确认的收入**：收入大表中记录的某笔收入在本年度确认的金额。该字段将通过导入时的列映射指定。
- **附件**：与收入相关的电子证据文件，如PDF、图片、扫描件等。
- **附件确认的收入**：用户根据附件内容手动填写的、经核实后的某笔收入金额。
- **差异**：本年确认的收入与附件确认的收入之间的差额。

------

### 2. 总体需求

本程序将采用模块化设计，主要分为以下几个核心模块：

- **数据导入与管理模块**
- **证据管理与关联模块**
- **收入核算与差异分析模块**
- **数据查询与导出模块**
- **统计分析模块**
- **系统设置与数据持久化模块**
- **用户界面模块**

------

### 3. 功能需求（Functional Requirements）

#### 3.1 数据导入与管理模块

**FR-DIM-001：收入大表导入**

- **描述**：用户能够导入外部的**Excel格式**收入大表文件。

- 详细需求

  ：

  - 支持常见的Excel文件格式导入（**.xls, .xlsx**）。

  - 导入时提供

    列映射功能

    ，允许用户将导入文件中对应的列与程序内部的

    固定字段

    进行匹配：

    - **合同号**
    - **客户名**
    - **本年确认的收入**

  - **合同号必须作为唯一识别码**。若导入数据中存在重复合同号，程序应提示用户处理（例如，选择覆盖、跳过或合并）。

  - 成功导入后，数据显示在主界面列表中。

**FR-DIM-002：多版本收入大表管理**

- **描述**：程序需支持用户多次导入收入大表，并能管理不同版本的收入数据。

- 详细需求

  ：

  - 每次导入的收入大表应被视为一个新的版本，程序应记录导入时间。
  - 用户可以选择查看历史版本的数据。

**FR-DIM-003：收入变化追踪与新增标识**

- **描述**：每次导入新的收入大表后，程序应自动比较与上次导入的数据差异。

- 详细需求

  ：

  - 对于现有合同（通过合同号匹配），计算并显示其“本年确认的收入”金额与上次导入时对应合同金额的**变化**（增长或减少）。
  - 对于新出现的合同号（在上次导入数据中不存在），程序应在列表中相应合同项旁或备注列中**自动标记“新增”**。
  - 变化数据应直观显示，例如通过颜色区分（绿色表示增长，红色表示减少）。

#### 3.2 证据管理与关联模块

**FR-EMA-001：附件上传与关联**

- **描述**：用户可以将收入证据文件（附件）与收入大表中的特定合同进行关联。

- 详细需求

  ：

  - 支持通过**拖拽方式**将附件文件关联到列表中的合同项。
  - 支持通过文件选择对话框**批量上传**附件并进行关联。
  - **支持所有格式的附件文件**（如zip、rar、pdf、png、eml等）。
  - 一个合同可以关联多个附件。
  - 程序应在内部记录附件与合同的关联关系。

**FR-EMA-002：附件自动归档**

- **描述**：当附件与合同关联后，程序应自动将附件文件复制到用户指定位置的合同文件夹中。

- 详细需求

  ：

  - 在**系统设置**中，用户可以**指定一个根目录作为附件的存储路径**。该路径在程序启动时可选择默认或由用户修改。
  - 在该根目录下，程序将自动创建以**合同号为名称的子文件夹**。
  - 当附件被关联到某个合同后，该附件的副本将**自动复制**到对应的合同号文件夹内。
  - 如果附件与多个合同关联，其副本将分别复制到各个关联合同的文件夹中。

**FR-EMA-003：附件数量显示**

- **描述**：在主界面列表中，每条收入记录应显示已关联的附件数量。

- 详细需求

  ：

  - 在列表的一列中，直观显示每个合同记录已关联的**附件数量**（例如“3个附件”）。

**FR-EMA-004：附件文件夹快捷访问**

- **描述**：用户可以通过程序快速访问与合同关联的附件文件。

- 详细需求

  ：

  - **双击主列表中任一合同记录，程序应自动打开该合同对应的本地附件文件夹**（即FR-EMA-002中创建的合同号文件夹）。

#### 3.3 收入核算与差异分析模块

**FR-RDA-001：附件确认收入录入**

- **描述**：用户可以在列表中手动输入基于附件核实后的收入金额。

- 详细需求

  ：

  - 在主界面列表中，为每条收入记录提供一个可编辑的字段，用于用户输入**“附件确认的收入”**。

**FR-RDA-002：收入差异计算**

- **描述**：程序自动计算“本年确认的收入”与“附件确认的收入”之间的差异。

- 详细需求

  ：

  - 差异计算公式：**差异 = 本年确认的收入 - 附件确认的收入**。
  - 差异结果应实时显示在列表中。
  - 差异金额可根据正负值进行颜色区分（例如，差异为0或正数显示绿色，负数显示红色）。

**FR-RDA-003：差异原因备注**

- **描述**：用户可以为每条收入记录的差异添加备注，说明差异产生的原因。

- 详细需求

  ：

  - 在列表中为每条收入记录提供一个可编辑的**备注**字段。
  - 备注内容应能保存并随数据导出。

#### 3.4 数据查询与导出模块

**FR-QEM-001：列表筛选功能**

- **描述**：用户可以根据不同条件对主界面的收入列表进行筛选。

- 详细需求

  ：

  - 支持按**合同号、客户名、收入来源、差异状态**（如：有差异、无差异）、**附件关联状态**（如：已关联附件、未关联附件）、**新增合同**等字段进行筛选。
  - 可支持多条件组合筛选。

**FR-QEM-002：数据导出**

- **描述**：用户可以将程序中的所有数据或筛选后的数据导出。

- 详细需求

  ：

  - 支持将数据导出为**Excel格式文件**。
  - 导出的文件应包含所有列表字段，包括合同号、客户名、本年确认的收入、附件确认的收入、差异、差异备注、附件数量、以及上次导入对比变化等信息。
  - 导出文件名可由用户自定义或自动生成包含日期时间戳的名称。

#### 3.5 统计分析模块

**FR-SAM-001：基础统计概览**

- **描述**：程序提供一个独立的统计分析视图，显示关键的收入管理数据。

- 详细需求

  ：

  - 显示**“已获取证据的金额占总收入的比例”**（即附件确认的收入总和 / 本年确认的收入总和）。
  - 显示**总收入金额、总附件确认收入金额**。
  - 显示**有差异的合同数量、无差异的合同数量**。
  - 显示**已关联附件的合同数量、未关联附件的合同数量**。
  - 统计图表（如饼图、柱状图）辅助展示上述比例和数量。

#### 3.6 系统设置与数据持久化模块

**FR-SSP-001：附件存储路径设置**

- **描述**：用户可以自定义附件的存储根路径。

- 详细需求

  ：

  - 提供设置界面，允许用户选择或修改附件存储的根目录。
  - 该设置应被**持久化保存**，在程序重启后依然生效。
  - 程序**首次启动时，应引导用户指定此路径**。

**FR-SSP-002：数据持久化**

- **描述**：程序能够保存用户操作的数据，确保关闭程序后数据不丢失。

- 详细需求

  ：

  - 程序应自动保存所有收入数据、附件关联信息、差异、备注、设置等。
  - 用户**关闭程序后重新打开，所有原有的数据都应被加载显示**，除非用户明确选择“新建项目”或类似操作来清空数据。

**FR-SSP-003：数据备份与恢复**

- **描述**：用户可以手动创建数据备份，并在需要时进行恢复。

- 详细需求

  ：

  - 提供**“备份数据”**功能，将当前程序的所有核心数据打包保存到用户指定的位置。
  - 提供**“恢复数据”**功能，允许用户从之前创建的备份文件中恢复数据，恢复前应有警告提示（如会覆盖当前数据）。

**FR-SSP-004：新建项目**

- **描述**：用户可以选择新建一个空白的项目，清空当前所有数据。

- 详细需求

  ：

  - 提供“新建项目”功能，执行此操作前需有**明确的警告和二次确认**，提示用户当前数据将被清空。

#### 3.7 用户界面模块

**FR-UIM-001：界面整洁美观**

- **描述**：程序界面应简洁、直观、易于操作。

- 详细需求

  ：

  - 采用现代UI设计风格。
  - 布局合理，功能区域划分清晰。
  - 重要的操作按钮和信息应突出显示。

**FR-UIM-002：用户友好性**

- **描述**：提供清晰的提示和反馈，引导用户操作。

- 详细需求

  ：

  - 导入、导出、关联等操作应有进度条或成功/失败提示。
  - 在必要时提供操作指引或帮助文档。

------

### 4. 非功能需求（Non-Functional Requirements）

#### 4.1 性能需求

- **PERF-001**：程序启动时间应在5秒以内。
- **PERF-002**：导入包含**5000-10000条记录**的收入大表应在15秒内完成。
- **PERF-003**：数据筛选和查询操作响应时间应在2秒以内。
- **PERF-004**：附件关联和复制操作应在合理时间内完成（例如，单文件<1秒，批量文件根据大小和数量而定，但应给出进度反馈）。

#### 4.2 可用性需求

- **USABILITY-001**：程序应提供清晰的错误提示和解决方案建议。
- **USABILITY-002**：重要操作（如删除数据、新建项目）应有二次确认机制。
- **USABILITY-003**：用户界面应直观，无需复杂培训即可上手使用。

#### 4.3 兼容性需求

- **COMPAT-001**：程序应兼容主流的操作系统（如Windows 10/11）。
- **COMPAT-002**：支持常见的Excel文件格式（.xls, .xlsx）。

#### 4.4 安全性需求

- **SECURITY-001**：由于涉及个人财务数据，程序应确保数据存储在本地，不上传至任何云端服务器。
- **SECURITY-002**：确保本地数据存储的完整性和可靠性，防止数据丢失或损坏。

#### 4.5 可维护性与可扩展性

- **MAINTAIN-001**：采用模块化设计，代码结构清晰，便于后期维护和功能扩展。
- **MAINTAIN-002**：未来易于增加新的统计维度或数据分析功能。
- **MAINTAIN-003**：日志记录功能，便于问题排查。